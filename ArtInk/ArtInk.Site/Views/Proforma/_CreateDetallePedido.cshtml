@model ArtInk.Site.ViewModels.Request.PedidoRequestDto

<div class="row mb-4">
    <div class="col-sm-12 col-md-12">
        <label for="IdServicio" class="form-label">Servicios</label>
    </div>
    <div class="col-sm-10 col-md-11">
        <select id="IdServicioSelect" class="form-select"
            asp-items='@(new SelectList(Model.Servicios, "Id" , "DescripcionCompletaSelect"))'></select>
    </div>
    <div class="col-sm-2 col-md-1">
        <button type="button" class="btn btn-success btn-sm flex-fill m-0" onclick="agregarDetalle(this)">
            <span class="material-symbols-outlined">
                add
            </span>
        </button>
    </div>
</div>

<div class="row">
    <div class="col-sm-12 col-md-12">
        <label for="IdServicio" class="form-label">Detalle de factura</label>
    </div>
    <div class="col-sm-12 col-md-12 mb-4" id="DetallesAgregados">
        <table class="w-100">
            <thead>
                <tr>
                    <th>NÂº</th>
                    <th>Servicio</th>
                    <th>Tarifa</th>
                    <th>Cantidad</th>
                    <th>Subtotal</th>
                    <th>Impuesto</th>
                    <th>Total</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach(var item in Model.DetallePedidos.Select((x, i) => new { Value = x, Index = i }))
                {
                    <tr>
                        <div hidden>
                            <input name="DetallePedidos[@item.Index].NumeroLinea" value="@item.Value.NumeroLinea" />
                            <input name="DetallePedidos[@item.Index].IdServicio" value="@item.Value.IdServicio" />
                            <input name="DetallePedidos[@item.Index].Servicio.Nombre" value="@item.Value.Servicio.Nombre" />
                            <input name="DetallePedidos[@item.Index].Servicio.Descripcion" value="@item.Value.Servicio.Descripcion" />
                            <input name="DetallePedidos[@item.Index].Servicio.TipoServicio.Nombre" value="@item.Value.Servicio.TipoServicio.Nombre" />
                            <input name="DetallePedidos[@item.Index].Servicio.Tarifa" id="TarifaServicioDetalle-@item.Value.NumeroLinea" value="@item.Value.Servicio.Tarifa.ToString("#,##0.00")" />
                        </div>
                        <td>
                            @item.Value.NumeroLinea
                        </td>
                        <td>
                            @item.Value.Servicio.Nombre
                        </td>
                        <td>
                            @item.Value.Servicio.Tarifa.ToString("#,##0.00")
                        </td>
                        <td class="text-right">
                            <input name="DetallePedidos[@item.Index].CantidadFormateada" id="CantidadDetalle-@item.Value.NumeroLinea" data-mask="#,##0" data-mask-reverse="true" data-linea="@item.Value.NumeroLinea" class="form-control cantidad calculo-detalle text-end" onkeyup="calcularTotalesLinea(this)" value="@item.Value.CantidadFormateada">
                        </td>
                        <td>
                            <input name="DetallePedidos[@item.Index].MontoSubtotal" readonly id="SubTotalDetalle-@item.Value.NumeroLinea" class="form-control subtotal text-end" value="@item.Value.MontoSubtotal">
                        </td>
                        <td>
                            <input name="DetallePedidos[@item.Index].MontoImpuesto" readonly id="ImpuestoDetalle-@item.Value.NumeroLinea" class="form-control impuesto text-end" value="@item.Value.MontoImpuesto">
                        </td>
                        <td>
                            <input name="DetallePedidos[@item.Index].MontoTotal" readonly id="TotalDetalle-@item.Value.NumeroLinea" class="form-control total text-end" value="@item.Value.MontoTotal">
                        </td>
                        <td>
                            <button type="button" class="btn btn-danger btn-sm flex-fill m-0" data-linea="@item.Value.NumeroLinea" onclick="eliminarDetalle(this)">
                                    <span class="material-symbols-outlined">
                                        close
                                    </span>
                                </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>